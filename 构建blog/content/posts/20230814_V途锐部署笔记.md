---
title: V途锐部署笔记
date: 2023-08-14T22:54:59+08:00
categories: [
  "VPN"
]
tags: [
    "V途锐",
  "Caddy",
  "VPS"
]
---



## 前言
   VPS的IP被墙了，在此之前，V途锐在搬瓦工已经安稳运行了8个月了。不知道是因为在VPS部署了Chanzhaoyu/chatgpt-web的项目的缘故(因为大约在被墙的前两周发现该项目使用的3002端口被封了)，还是因为升级的V途锐的版本的问题(升级后稀里糊涂重新配置了VM3SS链接，可能伪装比较差)。总之之前那个VPS的IP报废了。之后又慌忙花了60块钱换了个新IP(心疼)，花了一天的时间恢复了网站，并且把V途锐使用了VM3SS+WS+TLS伪装。结果第二天发现又有被墙的迹象，主要表现为域名解析出现问题，通过域名访问不了VPS了，但是通过[ping.pe](https://ping.pe)检测，国内均能ping通。于是抓紧想办法补救。结果还真有办法，而且之前换IP的那60元，也成了冤枉钱。
具体办法是:
+  IP地址使用CDN隐藏
+ V途锐使用了VM3SS+WS+TLS伪装
+ 客户端使用建议


## IP地址隐藏/救活被墙的IP
CDN主要是用于网络加速，但是免费且不需要备案的服务商CloudFlare的CDN号称“减速云”，不过好在能隐藏IP和复活被墙的IP啊。
+ 首先需要有一个域名(自行申请)。
+ 之后在[cloudflare.com](https://cloudflare.com)上注册一个账号(如果网站是英文的，右上角可以选择中文，具体注册流程很简单，网上教程也一堆，就不详细说了)。
+ 登录进入仪表板(dash),点击"添加站点"，之后输入域名并确认。
+ 选择“计划”，使用最下边的Free并确认即可。
+ 在接下来的页面，提示你需要在域名购买商那里，把默认的DNS服务器(名称服务器)修改为网页中提供的那两个DNS服务器。这个页面不要关掉，后边还有用！
+ 按要求去之前的域名购买商那里修改DNS。每家域名提供商都不一样，可以自己搜索修改教程。修改快的话可能几分钟后生效，长的话可能24小时。
+ 回到cloudflare刚才的页面中，点击检查名称服务器，看看是否修改成功。成功后，就可以设置域名解析了。
+ 仪表板最左边菜单选DNS，就可以打开域名解析的设置。(假设我VPS的IP地址是 192.xx.xx.xx,域名是 hotine.wang)添加记录,建议如下∶

  | 类型 | 名称 | IPV4 | 备注 |
  | --- | --- | --- | --- |
  | A | @ | 192.xx.xx.xx | hotine.wang 解析到对应IP |
  | A | * | 192.xx.xx.xx | 默认所有的子域名都解析到对应IP，例如 abc.hotine.wang,www.hotine.wang |
  | A | x | 192.xx.xx.xx | x.hotine.wang 解析到对应的IP，这个是给后续跑V途锐做伪装用的 |
  | CNAME | blog | hotine.github.com | blog.hotine.wang 解析到 hotine.github.com |

注意上表的解析设置中，TTL都选自动，x的解析状态都选开启。
这样再用[https://ping.pe](ping.pe)等PING工具去测试 hotine.wang 时，显示的IP就不再是真实的VPS的IP了，而是CDN的IP,从而隐藏了真实IP。


## V途锐流量伪装
查了很多资料都说websocket+tls+web的伪装最安全，协议用VM3SS或者VL3SS都行。
具体就是通过websocket协议把流量通过tls加密发送到一个部署了网站的服务器，由服务器解析后再交由V途锐程序处理并返回到客户。这样，V途锐的流量和正常访问网页内容的流量就看上去没有什么差别了，从而进行伪装。
使用这个模式需要网站开启https,开启https需要申请SSL/TLS证书，这就很麻烦了。所以使用Caddy网站部署服务，可以部署网站，并自动申请证书，让一切都变得简单。
+ 首先安装V途锐一键脚本，使用github上233boy/v2ray的脚本就行，这个脚本自带Caddy,非常方便。按照官方教程即可。用SSH工具连接VPS后，输入：
  ```bash
  bash <(wget -qO- -o- https://git.io/v2ray.sh)
  ```
+ 安装完毕后，会自动创建一个可用的VM3SS链接，可以用客户端试一下。能用的话说明安装配置没问题，再进行下一步。不能用的话可以用[https://ping.sx/check-port](https://ping.sx/check-port)测试下端口是否能ping通，不通的话可能是被防火墙屏蔽了，需要修改防火墙设置。
+ 选择添加配置，协议选择VM3SS+ES+TLS或者VL3SS+ES+TLS，按照提示输入内容即可。
  + 其中有一步需要输入域名，输入x.hotine.wang即可。脚本会自动用Caddy部署一个x.hotine.wang的网页。可以用浏览器访问这个网址测试，应该是白屏才对。
  + 还有一步会提升去cloudflare关掉x.hotine.wang的代理。
  + 最后设置都成功后，即可回到cloudflare再开启x.hotine.wang的代理。
+ 这样V途锐就能用了，把链接导入客户端使用即可。
+ 之后使用SSH工具，进入VPS的目录，修改网站设置文件：`/etc/caddy/233boy/x.hotine.wang.conf.add`,把文件正文改为：
  ```
  root * /opt/www/x   #这个路径代表网页文件再VPS的位置
  file_server   #这个代表使用静态网页服务
  ```
+ 保存后，使用`v2ray restart caddy`命令重启caddy服务即可生效。
+ 用自己的或者网上下载的网页模板，上传到`/opt/www/x`路径中，一个伪装网站就建好了。
+ 当然，也可以直接用hotine.wang做伪装网站，相应的修改上面的设置即可。

## V途锐客户端使用建议
+ 搭建完成后，尽量避免多用户、多客户端同时连接使用，这样会更容易被封。
+ 国内各大科技厂商，窥探隐私的欲望比较强烈，因此不要安装国产杀毒软件,不要使用国产浏览器,使用国产输入法也有风险。
+ 尽量避免使用V2Ray客户端的全局代理模式上网。如果你的所有流量都指向一个国外IP，这是非常可疑的。 电脑端推荐设置为PAC模式，或者国外IP走代理。手机端推荐设置为分应用代理，比如只让浏览器走代理。
+ 尽量避免在安卓手机上长时间使用，尽量避免在安卓手机上长时间、大流量科学上网，毕竟国内各大手机厂商的系统基本都会收集个人数据。
